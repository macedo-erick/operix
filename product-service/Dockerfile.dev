# Development Dockerfile - runs gradle bootRun with hot-reload
FROM eclipse-temurin:21-jdk-alpine

# Install curl for health checks and bash
RUN apk add --no-cache curl bash

WORKDIR /app

# Keep Gradle caches in a writable location when running as non-root
ENV GRADLE_USER_HOME=/app/.gradle

# Copy gradle wrapper and build files
COPY gradlew settings.gradle build.gradle ./
COPY gradle ./gradle

# Make gradlew executable
RUN chmod +x gradlew

# Download dependencies once (layer caching)
RUN ./gradlew dependencies --no-daemon || true

# Source code will be mounted as volume at runtime
EXPOSE 8083

# Run Spring Boot with DevTools enabled
CMD ["./gradlew", "bootRun", "--no-daemon", "-Dspring.devtools.restart.enabled=true"]
